<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Plant AI</title>
    <!-- Import Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/628/628283.png">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f6;
            text-align: center;
            padding: 20px;
            margin: 0;
            color: #333;
        }

        h1 { color: #2E7D32; margin-bottom: 5px; }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* --- NEW: App Icon Styling --- */
        .app-icon {
            width: 80px;  /* Adjust size here */
            height: 80px;
            border-radius: 15px; /* Rounded corners */
            margin: 10px auto;
            display: block;
        }

        /* The camera view */
        #webcam-container {
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            background-color: #000;
            min-height: 300px;
        }

        canvas {
            border-radius: 10px;
            display: block; 
        }

        /* Buttons */
        .btn {
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: background-color 0.3s;
        }

        .btn-start { background-color: #4CAF50; }
        .btn-start:hover { background-color: #388E3C; }

        .btn-switch { 
            background-color: #2196F3; 
            display: none; 
        }
        .btn-switch:hover { background-color: #1976D2; }

        /* Prediction Result Text */
        #label-container {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        /* The Medical Advice Box */
        .advice-box {
            margin-top: 25px;
            padding: 20px;
            border-left: 6px solid #ccc;
            background-color: #f9f9f9;
            text-align: left;
            display: none; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .advice-box h3 { margin-top: 0; }

        .healthy { border-color: #4CAF50; background-color: #e8f5e9; color: #1b5e20; }
        .danger { border-color: #f44336; background-color: #ffebee; color: #b71c1c; }
        .warning { border-color: #ff9800; background-color: #fff3e0; color: #e65100; }

        .loading {
            display: none;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>Doctor Plant AI</h1>
        
        <!-- THIS IS YOUR ICON -->
        <!-- Replace the link below with "icon.png" if you have your own file -->
        <img src="icon.png" alt="App Icon" class="app-icon">

        <p>Point your camera at a plant leaf to detect diseases.</p>

        <!-- Buttons -->
        <button id="start-btn" class="btn btn-start" type="button" onclick="init()">Start Camera</button>
        <button id="switch-btn" class="btn btn-switch" type="button" onclick="switchCamera()">üîÑ Switch Camera</button>
        
        <div id="loading" class="loading">Loading AI Model...</div>
        
        <div id="webcam-container"></div>
        <div id="label-container"></div>
        
        <div id="advice-box" class="advice-box">
            <h3 id="diagnosis-title">Diagnosis</h3>
            <p id="diagnosis-text">Waiting for plant...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    
    <script type="text/javascript">
        // -----------------------------------------------------------------
        // TODO: PASTE YOUR TEACHABLE MACHINE URL HERE
        const URL = "https://teachablemachine.withgoogle.com/models/aEomgFfvV/"; 
        // -----------------------------------------------------------------

        let model, webcam, labelContainer, maxPredictions;
        let isBackCamera = false; 
        let requestID; 

        // --- THE DOCTOR'S BRAIN ---
        const medicalAdvice = {
            "Healthy": {
                class: "healthy",
                text: "‚úÖ <b>Status:</b> Healthy Plant.<br>Great job! Keep maintaining your current watering and sunlight schedule."
            },
            "Powdery Mildew": {
                class: "warning",
                text: "‚ö†Ô∏è <b>Issue:</b> Fungal Infection (White Spots).<br><b>Cure:</b> Mix 1 tbsp baking soda with water and spray leaves. Remove badly infected parts."
            },
            "Rust": {
                class: "danger",
                text: "üö´ <b>Issue:</b> Rust Fungus (Orange/Brown Spots).<br><b>Cure:</b> Isolate this plant immediately! Use a sulfur-based fungicide or neem oil."
            },
            "Needs Water": {
                class: "warning",
                text: "üíß <b>Issue:</b> Dehydration.<br><b>Cure:</b> Check soil moisture. Water deeply until it runs out the bottom of the pot."
            }
        };

        async function init() {
            if (URL === "PASTE_YOUR_URL_HERE") {
                alert("‚ö†Ô∏è Please edit the index.html file and paste your Teachable Machine URL inside the code!");
                return;
            }

            document.getElementById("start-btn").style.display = "none";
            document.getElementById("loading").style.display = "block";

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                await setupWebcam();
                document.getElementById("loading").style.display = "none";
                document.getElementById("switch-btn").style.display = "inline-block"; 
                labelContainer = document.getElementById("label-container");
            } catch (error) {
                alert("Error: " + error);
                document.getElementById("loading").innerText = "Failed to load system.";
                document.getElementById("start-btn").style.display = "inline-block";
            }
        }

        async function setupWebcam() {
            if (webcam) {
                if(requestID) window.cancelAnimationFrame(requestID);
                await webcam.stop();
                document.getElementById("webcam-container").innerHTML = ""; 
            }

            const flip = !isBackCamera; 
            const width = 300;
            const height = 300;
            webcam = new tmImage.Webcam(width, height, flip); 
            
            const constraints = {
                facingMode: isBackCamera ? "environment" : "user"
            };

            try {
                await webcam.setup(constraints); 
                await webcam.play();
                requestID = window.requestAnimationFrame(loop);
                document.getElementById("webcam-container").appendChild(webcam.canvas);
            } catch (err) {
                alert("Camera Error: " + err);
            }
        }

        async function switchCamera() {
            isBackCamera = !isBackCamera;
            await setupWebcam();
        }

        async function loop() {
            webcam.update(); 
            await predict();
            requestID = window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            
            let highestProb = 0;
            let bestClass = "";

            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > highestProb) {
                    highestProb = prediction[i].probability;
                    bestClass = prediction[i].className;
                }
            }

            if (highestProb > 0.80) {
                let cleanName = bestClass; 
                if(bestClass.match(/^\d/)) {
                    cleanName = bestClass.replace(/^\d+\s*/, '');
                }

                labelContainer.innerHTML = cleanName + " (" + (highestProb * 100).toFixed(0) + "%)";
                
                const adviceBox = document.getElementById("advice-box");
                const adviceTitle = document.getElementById("diagnosis-title");
                const adviceText = document.getElementById("diagnosis-text");
                
                adviceBox.style.display = "block";
                
                if (medicalAdvice[cleanName]) {
                    adviceBox.className = "advice-box " + medicalAdvice[cleanName].class;
                    adviceTitle.innerText = "Diagnosis: " + cleanName;
                    adviceText.innerHTML = medicalAdvice[cleanName].text;
                } else {
                    adviceBox.className = "advice-box";
                    adviceTitle.innerText = "Detected: " + cleanName;
                    adviceText.innerText = "No specific medical advice found for this condition.";
                }
            }
        }
    </script>
</body>
</html>